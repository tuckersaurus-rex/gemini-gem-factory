name: Deploy to Google Drive

on:
  # 1. Allows you to click a button to test (Manual Trigger)
  workflow_dispatch:
  # 2. Automatically runs when you push to main (Future proofing)
  push:
    branches:
      - main
      - "feature/implement-google-drive-deployment"

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # --- SETUP ---
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Rclone
        run: sudo -v ; curl https://rclone.org/install.sh | sudo bash

      # --- CONFIGURATION ---
      - name: Setup Rclone Config
        env:
          RCLONE_CONF: ${{ secrets.RCLONE_CONF }}
          GDRIVE_FOLDER: ${{ secrets.GEMINI_CONFIG_FOLDER_ID }}
        run: |
          # Create the config directory
          mkdir -p ~/.config/rclone
          # Write the secret to the config file
          echo "$RCLONE_CONF" > ~/.config/rclone/rclone.conf

      # --- DEPLOY ---
      - name: Upload to Google Drive
        run: |
          # Copy the 'dist' folder to a '$GDRIVE_FOLDER' folder on your Drive
          # 'gdrive' matches the [header] in your config file
          rclone copy ./brains gdrive:_GitHub_Deployment_Test
