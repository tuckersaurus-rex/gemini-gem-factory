name: Deploy to Google Drive

on:
  push:
    branches:
      - main # Trigger on pushes to main

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout your code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. (Optional) Build your project here if needed
      # - name: Build Project
      #   run: npm install && npm run build

      # 3. Install Rclone
      - name: Install Rclone
        run: sudo -v ; curl https://rclone.org/install.sh | sudo bash

      # 4. Authenticate and Copy
      - name: Sync to Google Drive
        env:
          # Load the secret into an env var
          GDRIVE_SA_KEY: ${{ secrets.GSA_CREDENTIALS }}
          GDRIVE_FOLDER: ${{ secrets.GEMINI_CONFIG_FOLDER_ID }}
        run: |
          # Create the auth file from the secret
          echo "$GDRIVE_SA_KEY" > sa_key.json

          # Configure rclone to use the service account
          # "gdrive" is the name we are giving this connection
          # "drive" is the type of storage (Google Drive)
          rclone config create gdrive drive service_account_file ./sa_key.json --non-interactive

          # Run the copy command
          # Usage: rclone copy <local_path> <remote_name>:<remote_folder>
          # Replace './files-to-copy' with your actual folder (e.g., ./dist or ./src)
          rclone copy ./brains gdrive:"$GDRIVE_FOLDER"

          # Cleanup the key file for security
          rm sa_key.json
